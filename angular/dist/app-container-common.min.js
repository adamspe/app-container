/*
 * app-container-common
 * Version: 1.0.0 - 2017-01-28
 */
angular.module("app-container-common.directives",[]).directive("spinner",[function(){return{restrict:"AEC",template:'<i ng-if="working()" class="fa fa-spinner fa-pulse fa-2x"></i>',scope:{working:"&isWorking"}}}]),angular.module("app-container-common.filters",[]),angular.module("app-container-common",["app-container-common.providers","templates-app-container-common","app-container-common.filters","app-container-common.services","app-container-common.directives"]).config(["$logProvider",function(a){a.debugEnabled(window.location.hash&&window.location.hash.match(/^#.*#debug/))}]),angular.module("templates-app-container-common",["js/services/confirm-dialog.html","js/services/notification-area.html"]),angular.module("js/services/confirm-dialog.html",[]).run(["$templateCache",function(a){a.put("js/services/confirm-dialog.html",'<div class="modal-header">\n    <span ng-if="!contents.noIcon"><i class="fa fa-{{contents.icon||\'exclamation-triangle\'}} fa-{{contents.iconSize||\'3\'}}x"></i></span>\n    <h4>{{contents.question}}</h4>\n</div>\n<div class="modal-body">\n    <p ng-if="contents.warning" class="text-danger">Warning: {{contents.warning}}</p>\n    <p ng-if="contents.more">{{contents.more}}</p>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-default" ng-click="no()">{{contents.noText||\'No\'}}</button>\n    <button class="btn btn-default" ng-click="yes()">{{contents.yesText||\'Yes\'}}</button>\n</div>')}]),angular.module("js/services/notification-area.html",[]).run(["$templateCache",function(a){a.put("js/services/notification-area.html",'<div id="notification-area">\n    <div uib-alert ng-repeat="alert in alerts" ng-class="\'alert-\'+alert.type" close="closeAlert($index)"><span ng-bind-html="alert.msg"></span></div>\n</div>\n')}]),angular.module("app-container-common.providers",["ngResource"]).provider("$typeAheadFinder",[function(){this.$get=["$q","$timeout","$log",function(a,b,c){return function(d,e,f){e=e||function(a){return"contains(text,'"+a+"')"},f=f||angular.identity;var g;return function(h){g&&b.cancel(g);var i=a.defer();return g=b(function(){c.debug("typeaheadFinder",h),d.query({$filter:e(h)},function(a){i.resolve(a.list.filter(f))}),i.promise.then(function(a){return a})},500),i.promise}}}]}]).provider("$apiConfig",[function(){this.apiRoot="/api/v1/",this.$get=[function(){return{apiRoot:this.apiRoot}}]}]).provider("$appService",[function(){this.$get=["$log","$resource","$http","$q","$sce","$apiConfig",function(a,b,c,d,e,f){a.debug("$apiConfig",f);var g=f.apiRoot;return function(a,f,h){function i(a,b){return l.$$htmlAtts.forEach(function(b){delete a["$"+b]}),Object.keys(a).forEach(function(b){/^_/.test(b)&&angular.isObject(a[b])&&a[b]._id&&(a[b]=a[b]._id)}),angular.toJson(a)}var j=function(a,b){var c=angular.fromJson(a);return new l(c)},k=b(g+a,{},{get:{method:"GET",transformResponse:j},query:{method:"GET",isArray:!1,transformResponse:function(a,b){var c=angular.fromJson(a);return c&&c.list&&c.list.length&&(c.list=c.list.map(function(a){return new l(a)})),c}},update:{method:"PUT",transformRequest:i,transformResponse:j},save:{method:"POST",transformRequest:i,transformResponse:j}}),l=function(){k.apply(this,arguments),l.$$each(this)};return Object.getOwnPropertyNames(k).forEach(function(a){["caller","arguments"].indexOf(a)===-1&&(l[a]=k[a])}),l.$$htmlAtts=f||[],l.$$custom_each=h||angular.identity,l.$$each=function(a){return a=l.$$custom_each(a),l.$$htmlAtts.forEach(function(b){a[b]&&(a["$"+b]=e.trustAsHtml(a[b]))}),a},l.prototype.chaseLink=function(a,b,e){var f=d.defer(),g=this._links[a];return e=e||{},c.get(g,e).then(function(a){var c=a.data;c&&c.list?(c.list=c.list.map(function(a){return new b(a)}),f.resolve(c)):f.reject()}),f.promise},l}}]}]),angular.module("app-container-common.services",["app-container-common.providers"]).controller("ConfirmDialogCtrl",["$scope","$uibModalInstance","contents",function(a,b,c){a.contents=c,a.yes=b.close,a.no=b.dismiss}]).factory("DialogService",["$q","$uibModal",function(a,b){var c={confirm:function(c){var d=a.defer();return b.open({controller:"ConfirmDialogCtrl",templateUrl:"js/services/confirm-dialog.html",windowClass:"confirm-dialog",backdrop:"static",keyboard:!1,resolve:{contents:function(){return c}}}).result.then(d.resolve,d.reject),d.promise}};return c}]).directive("notificationArea",["NotificationService",function(a){return{restrict:"E",templateUrl:"js/services/notification-area.html",link:function(b){b.alerts=a.getAlerts(),b.closeAlert=a.closeAlert}}}]).factory("NotificationService",["$log","$timeout","$sce",function(a,b,c){var d=[],e=function(a){d.splice(a,1)},f={closeAlert:e,getAlerts:function(){return d},addError:function(a){var b=a&&a.statusText?a.statusText:"";a&&a.data&&a.data.message&&(b+=" : "+a.data.message),d.push({type:"danger",msg:c.trustAsHtml(b)})},addInfo:function(a){a=c.trustAsHtml(a);var f=5e3;arguments.length>1&&(f=arguments[1]);var g=d.push({type:"success",msg:a})-1;f>0&&b(function(){e(g)},f)},clear:function(){d.length=0}};return f}]).factory("WebSocketConnection",["$log","$window","$apiConfig",function(a,b,c){function d(d,f){this.$wsUrl="ws://"+b.location.host+("/"===d.charAt(0)?d:c.apiRoot+d),a.debug("WebSocketConnection.wsUrl",this.$wsUrl),this.$cx=new e(this.$wsUrl),"function"==typeof f&&(this.$cx.onopen=f)}var e=b.WebSocket||b.MozWebSocket;return d.prototype.url=function(){return this.$wsUrl},d.prototype.connection=function(){return this.$cx},d.prototype.onMessage=function(b){var c=this;c.connection().onmessage=function(c){a.debug("WebSocketConnection.message",c);var d=c.data;"string"==typeof d&&"{"===d.charAt(0)&&(d=JSON.parse(d)),b(d,c)}},d.prototype.send=function(b){"object"==typeof b&&(b=JSON.stringify(b)),a.debug("WebSocketConnection.send",b),this.connection().send(b)},d.prototype.connectionCloser=function(){var a=this;return function(){a.connection().close()}},d}]);